<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>builder - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-Project-3A+Builder">Project: Builder</a>
    <li><a href="#label-Goal">Goal</a>
    <li><a href="#label-Classes">Classes</a>
    <li><a href="#label-Usage">Usage</a>
    <li><a href="#label-Compatibility">Compatibility</a>
    <li><a href="#label-Version+2.0.0+Compatibility+Changes">Version 2.0.0 Compatibility Changes</a>
    <li><a href="#label-Version+1.0.0+Compatibility+Changes">Version 1.0.0 Compatibility Changes</a>
    <li><a href="#label-Features">Features</a>
    <li><a href="#label-Links">Links</a>
    <li><a href="#label-Contact">Contact</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../Changelog_md.html">Changelog</a>
  
    <li><a href="../Gemfile.html">Gemfile</a>
  
    <li><a href="../Gemfile_lock.html">Gemfile.lock</a>
  
    <li><a href="../README_md.html">README</a>
  
    <li><a href="../docs/addressable_md.html">addressable</a>
  
    <li><a href="../docs/builder_md.html">builder</a>
  
    <li><a href="../docs/faraday_md.html">faraday</a>
  
    <li><a href="../docs/highline_md.html">highline</a>
  
    <li><a href="../docs/nokogiri_md.html">nokogiri</a>
  
    <li><a href="../features/specs/google_feature.html">google.feature</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page docs/builder.md">

<h1 id="label-Project-3A+Builder">Project: Builder<span><a href="#label-Project-3A+Builder">&para;</a> <a href="#top">&uarr;</a></span></h1>

<h2 id="label-Goal">Goal<span><a href="#label-Goal">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Provide a simple way to create XML markup and data structures.</p>

<h2 id="label-Classes">Classes<span><a href="#label-Classes">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Builder::XmlMarkup:: Generate XML markup notation Builder::XmlEvents:: Generate XML events (i.e. SAX-like)</p>

<p><strong>Notes:</strong></p>
<ul><li>
<p>An <code>Builder::XmlTree</code> class to generate XML tree  (i.e. DOM-like) structures is also planned, but not yet implemented.  Also, the events builder is currently lagging the markup builder in  features.</p>
</li></ul>

<h2 id="label-Usage">Usage<span><a href="#label-Usage">&para;</a> <a href="#top">&uarr;</a></span></h2>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rubygems&#39;</span>
  <span class="ruby-identifier">require_gem</span> <span class="ruby-string">&#39;builder&#39;</span>, <span class="ruby-string">&#39;~&gt; 2.0&#39;</span>

  <span class="ruby-identifier">builder</span> = <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">XmlMarkup</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">xml</span> = <span class="ruby-identifier">builder</span>.<span class="ruby-identifier">person</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">name</span>(<span class="ruby-string">&quot;Jim&quot;</span>); <span class="ruby-identifier">b</span>.<span class="ruby-identifier">phone</span>(<span class="ruby-string">&quot;555-1234&quot;</span>) }
  <span class="ruby-identifier">xml</span> <span class="ruby-comment">#=&gt; &lt;person&gt;&lt;name&gt;Jim&lt;/name&gt;&lt;phone&gt;555-1234&lt;/phone&gt;&lt;/person&gt;</span>
</pre>

<p>or</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rubygems&#39;</span>
  <span class="ruby-identifier">require_gem</span> <span class="ruby-string">&#39;builder&#39;</span>

  <span class="ruby-identifier">builder</span> = <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">XmlMarkup</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:target</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">STDOUT</span>, <span class="ruby-value">:indent</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">2</span>)
  <span class="ruby-identifier">builder</span>.<span class="ruby-identifier">person</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">name</span>(<span class="ruby-string">&quot;Jim&quot;</span>); <span class="ruby-identifier">b</span>.<span class="ruby-identifier">phone</span>(<span class="ruby-string">&quot;555-1234&quot;</span>) }
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># Prints:</span>
  <span class="ruby-comment"># &lt;person&gt;</span>
  <span class="ruby-comment">#   &lt;name&gt;Jim&lt;/name&gt;</span>
  <span class="ruby-comment">#   &lt;phone&gt;555-1234&lt;/phone&gt;</span>
  <span class="ruby-comment"># &lt;/person&gt;</span>
</pre>

<h2 id="label-Compatibility">Compatibility<span><a href="#label-Compatibility">&para;</a> <a href="#top">&uarr;</a></span></h2>

<h3 id="label-Version+2.0.0+Compatibility+Changes">Version 2.0.0 Compatibility Changes<span><a href="#label-Version+2.0.0+Compatibility+Changes">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Version 2.0.0 introduces automatically escaped attribute values for the first time. Versions prior to 2.0.0 did not insert escape characters into attribute values in the XML markup. This allowed attribute values to explicitly reference entities, which was occasionally used by a small number of developers. Since strings could always be explicitly escaped by hand, this was not a major restriction in functionality.</p>

<p>However, it did surprise most users of builder. Since the body text is normally escaped, everybody expected the attribute values to be escaped as well. Escaped attribute values were the number one support request on the 1.x Builder series.</p>

<p>Starting with Builder version 2.0.0, all attribute values expressed as strings will be processed and the appropriate characters will be escaped (e.g. “&amp;” will be translated to “&amp;amp;”). Attribute values that are expressed as Symbol values will not be processed for escaped characters and will be unchanged in output. (Yes, this probably counts as Symbol abuse, but the convention is convenient and flexible).</p>

<p>Example:</p>

<pre class="ruby"><span class="ruby-identifier">xml</span> = <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">XmlMarkup</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">sample</span>(<span class="ruby-value">:escaped</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&quot;This&amp;That&quot;</span>, <span class="ruby-value">:unescaped</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:&quot;Here&amp;amp;There&quot;</span>)
  <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">target!</span>  <span class="ruby-operator">=&gt;</span>
</pre>

<h3 id="label-Version+1.0.0+Compatibility+Changes">Version 1.0.0 Compatibility Changes<span><a href="#label-Version+1.0.0+Compatibility+Changes">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Version 1.0.0 introduces some changes that are not backwards compatible with earlier releases of builder. The main areas of incompatibility are:</p>
<ul><li>
<p>Keyword based arguments to <code>new</code> (rather than positional based). It  was found that a developer would often like to specify indentation  without providing an explicit target, or specify a target without  indentation. Keyword based arguments handle this situation nicely.</p>
</li><li>
<p>Builder must now be an explicit target for markup tags. Instead of  writing</p>
</li></ul>

<pre class="ruby"><span class="ruby-identifier">xml_markup</span> = <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">XmlMarkup</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-identifier">xml_markup</span>.<span class="ruby-identifier">div</span> { <span class="ruby-identifier">strong</span>(<span class="ruby-string">&quot;text&quot;</span>) }
</pre>

<p>you need to write</p>

<pre class="ruby"><span class="ruby-identifier">xml_markup</span> = <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">XmlMarkup</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-identifier">xml_markup</span>.<span class="ruby-identifier">div</span> { <span class="ruby-identifier">xml_markup</span>.<span class="ruby-identifier">strong</span>(<span class="ruby-string">&quot;text&quot;</span>) }
</pre>
<ul><li>
<p>The builder object is passed as a parameter to all nested markup  blocks. This allows you to create a short alias for the builder  object that can be used within the block. For example, the previous  example can be written as:</p>
</li></ul>

<pre class="ruby"><span class="ruby-identifier">xml_markup</span> = <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">XmlMarkup</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-identifier">xml_markup</span>.<span class="ruby-identifier">div</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">xml</span><span class="ruby-operator">|</span> <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">strong</span>(<span class="ruby-string">&quot;text&quot;</span>) }
</pre>
<ul><li>
<p>If you have both a pre-1.0 and a post-1.0 gem of builder installed,  you can choose which version to use through the RubyGems  <code>require_gem</code> facility.</p>
</li></ul>

<pre class="ruby"><span class="ruby-identifier">require_gem</span> <span class="ruby-string">&#39;builder&#39;</span>, <span class="ruby-string">&quot;~&gt; 0.0&quot;</span>   <span class="ruby-comment"># Gets the old version</span>
    <span class="ruby-identifier">require_gem</span> <span class="ruby-string">&#39;builder&#39;</span>, <span class="ruby-string">&quot;~&gt; 1.0&quot;</span>   <span class="ruby-comment"># Gets the new version</span>
</pre>

<h2 id="label-Features">Features<span><a href="#label-Features">&para;</a> <a href="#top">&uarr;</a></span></h2>
<ul><li>
<p>XML Comments are supported …</p>
</li></ul>

<pre class="ruby"><span class="ruby-identifier">xml_markup</span>.<span class="ruby-identifier">comment!</span> <span class="ruby-string">&quot;This is a comment&quot;</span>
      <span class="ruby-comment">#=&gt;  &lt;!-- This is a comment --&gt;</span>
</pre>
<ul><li>
<p>XML processing instructions are supported …</p>
</li></ul>

<pre class="ruby"><span class="ruby-identifier">xml_markup</span>.<span class="ruby-identifier">instruct!</span> <span class="ruby-value">:xml</span>, <span class="ruby-value">:version</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&quot;1.0&quot;</span>, <span class="ruby-value">:encoding</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&quot;UTF-8&quot;</span>
      <span class="ruby-comment">#=&gt;  &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</pre>

<p>If the processing instruction is omitted, it defaults to “xml”.  When the processing instruction is “xml”, the defaults attributes  are:</p>

<p><strong>version</strong>: 1.0  <strong>encoding</strong>: “UTF-8”</p>

<p>(NOTE: if the encoding is set to “UTF-8” and $KCODE is set to  “UTF8”, then Builder will emit UTF-8 encoded strings rather than  encoding non-ASCII characters as entities.)</p>
<ul><li>
<p>XML entity declarations are now supported to a small degree.</p>
</li></ul>

<pre class="ruby"><span class="ruby-identifier">xml_markup</span>.<span class="ruby-identifier">declare!</span> <span class="ruby-value">:DOCTYPE</span>, <span class="ruby-value">:chapter</span>, <span class="ruby-value">:SYSTEM</span>, <span class="ruby-string">&quot;../dtds/chapter.dtd&quot;</span>
      <span class="ruby-comment">#=&gt;  &lt;!DOCTYPE chapter SYSTEM &quot;../dtds/chapter.dtd&quot;&gt;</span>
</pre>

<p>The parameters to a declare! method must be either symbols or  strings. Symbols are inserted without quotes, and strings are  inserted with double quotes. Attribute-like arguments in hashes are  not allowed.</p>

<p>If you need to have an argument to declare! be inserted without  quotes, but the argument does not conform to the typical Ruby  syntax for symbols, then use the :“string” form to specify a symbol.</p>

<p>For example:</p>

<pre class="ruby"><span class="ruby-identifier">xml_markup</span>.<span class="ruby-identifier">declare!</span> <span class="ruby-value">:ELEMENT</span>, <span class="ruby-value">:chapter</span>, <span class="ruby-value">:&quot;(title,para+)&quot;</span>
      <span class="ruby-comment">#=&gt;  &lt;!ELEMENT chapter (title,para+)&gt;</span>
</pre>

<p>Nested entity declarations are allowed. For example:</p>

<pre class="ruby"><span class="ruby-ivar">@xml_markup</span>.<span class="ruby-identifier">declare!</span> <span class="ruby-value">:DOCTYPE</span>, <span class="ruby-value">:chapter</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">x</span>.<span class="ruby-identifier">declare!</span> <span class="ruby-value">:ELEMENT</span>, <span class="ruby-value">:chapter</span>, <span class="ruby-value">:&quot;(title,para+)&quot;</span>
      <span class="ruby-identifier">x</span>.<span class="ruby-identifier">declare!</span> <span class="ruby-value">:ELEMENT</span>, <span class="ruby-value">:title</span>, <span class="ruby-value">:&quot;(#PCDATA)&quot;</span>
      <span class="ruby-identifier">x</span>.<span class="ruby-identifier">declare!</span> <span class="ruby-value">:ELEMENT</span>, <span class="ruby-value">:para</span>, <span class="ruby-value">:&quot;(#PCDATA)&quot;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment">#=&gt;</span>

    <span class="ruby-operator">&lt;</span>
</pre>
<ul><li>
<p>Some support for XML namespaces is now available. If the first  argument to a tag call is a symbol, it will be joined to the tag to  produce a namespace:tag combination. It is easier to show this than  describe it.</p>
</li></ul>

<pre class="ruby"><span class="ruby-identifier">xml</span>.<span class="ruby-constant">SOAP</span> <span class="ruby-value">:Envelope</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">...</span> <span class="ruby-keyword">end</span>
</pre>

<p>Just put a space before the colon in a namespace to produce the  right form for builder (e.g. “<code>SOAP:Envelope</code>” =&gt;  “<code>xml.SOAP :Envelope</code>”)</p>
<ul><li>
<p>String attribute values are <em>now</em> escaped by default by  Builder (<strong>NOTE:</strong> this is <em>new</em> behavior as of version 2.0).</p>
</li></ul>

<p>However, occasionally you need to use entities in attribute values.  Using a symbol (rather than a string) for an attribute value will  cause Builder to not run its quoting/escaping algorithm on that  particular value.</p>

<p>(<strong>Note:</strong> The <code>escape_attrs</code> option for builder is now  obsolete).</p>

<p>Example:</p>

<pre class="ruby"><span class="ruby-identifier">xml</span> = <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">XmlMarkup</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">sample</span>(<span class="ruby-value">:escaped</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&quot;This&amp;That&quot;</span>, <span class="ruby-value">:unescaped</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:&quot;Here&amp;amp;There&quot;</span>)
    <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">target!</span>  <span class="ruby-operator">=&gt;</span>
</pre>
<ul><li>
<p>UTF-8 Support</p>
</li></ul>

<p>Builder correctly translates UTF-8 characters into valid XML. (New  in version 2.0.0). Thanks to Sam Ruby for the translation code.</p>

<p>You can get UTF-8 encoded output by making sure that the XML  encoding is set to “UTF-8” and that the $KCODE variable is set to  “UTF8”.</p>

<pre class="ruby"><span class="ruby-identifier">$KCODE</span> = <span class="ruby-string">&#39;UTF8&#39;</span>
    <span class="ruby-identifier">xml</span> = <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">Markup</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">instruct!</span>(<span class="ruby-value">:xml</span>, <span class="ruby-value">:encoding</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&quot;UTF-8&quot;</span>)
    <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">sample</span>(<span class="ruby-string">&quot;Iñtërnâtiônàl&quot;</span>)
    <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">target!</span>  <span class="ruby-operator">=&gt;</span>
</pre>

<h2 id="label-Links">Links<span><a href="#label-Links">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>| Description | Link | | :—-: | :—-: | | Documents | <a href="http://builder.rubyforge.org">builder.rubyforge.org</a>/ | | Github Clone | git://github.com/jimweirich/builder.git | | Issue / Bug Reports | <a href="https://github.com/jimweirich/builder/issues?state=open">github.com/jimweirich/builder/issues?state=open</a> |</p>

<h2 id="label-Contact">Contact<span><a href="#label-Contact">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>| Description | Value | | :—-: | :—-: | | Author | Jim Weirich | | Email | jim.weirich@gmail.com | | Home Page | <a href="http://onestepback.org">onestepback.org</a> | | License | MIT Licence (<a href="http://www.opensource.org/licenses/mit-license.html">www.opensource.org/licenses/mit-license.html</a>) |</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.1.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

